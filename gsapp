#!/bin/sh
set -eu

usage() {
  cat <<__USAGE__ >&2
usage: ${0##*/} <operation> [...]
operations:
  ${0##*/} add <name> <command>   # add a new application
  ${0##*/} help                   # show this help message
__USAGE__
}

warn() {
  echo "${0##*/}: $*" >&2
}

operation_add() {
  if [ $# -lt 2 ]; then
    warn "usage: ${0##*/} add <name> <command>"
    exit 2
  fi
  (
    name="$1"
    execute="$2"
    cat <<__DESKTOP_FILE__ > "$HOME/.local/share/applications/$name.desktop"
[Desktop Entry]
Name=$name
Exec=$execute
Type=Application
__DESKTOP_FILE__
  )
}

if [ $# -lt 1 ]; then
  usage
  exit 2
fi
operation="$1"
shift
case "$operation" in
  add)
    operation_add "$@"
    ;;
  help)
    usage
    exit 0
    ;;
  *)
    warn "invalid operation '$1'"
    exit 2
    ;;
esac
